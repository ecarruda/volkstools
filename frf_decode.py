#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import binascii
import click
import os
from zipfile import ZipFile
from io import BytesIO

__author__ = "Evandro Arruda"
__license__ = "GPL"
__version__ = "1.0.0"
__maintainer__ = "Evandro Arruda"
__email__ = "ecarruda@gmail.com"


class FRFDecoder:
    frf_key = (
        b"3221602d1719426b710f11297c61084375656e727e451b43430e39475e03480c7837644d315b4b6642541a0a"
        b"61115738661b346b2b6d12123807453f203e172326560f3a245273432e0b0b7372286a626d6566161f2d376b"
        b"067d73710c6b6a0425685c3827426a7b5d6d4b755602403303084a0502731a24346a4918154d49594d771c35"
        b"0240437171467a333d6e222006257f413e6c232b38132a5f0244286f754460620a76375a702168745b727870"
        b"1e456d127c203b473b7f0c7b596f0c46581108686b2c7c01037d58192a6c726f7c3f64184842653a2e682713"
        b"0679683a186f44270b214d76211e5d68215c2b2b14121d5b33625d48213b2f7a567e02725b5f44333d0f7b01"
        b"3c181269430870011d51507165704c323e4d3a1645623c0944201316290e342d36341e2379376a7a7f452463"
        b"453359016f6571703c6f3f063a795758366820773b2a1e2c32411d223642383a752d3c1b4d7c0f246b337124"
        b"3439024e63660467745d6342421c726e6c51782e7c6f6b294b027b631f40536c17601b58492f416e29607925"
        b"2d23024c2e7a2b0812481703282b3d63530c32796b752b3b60223e75205a683b3b542245655a307d6047102b"
        b"215c0a4f421933771f3b61716803622274396e365871597a390d0d055e03381e0960425a080d020507513143"
        b"28181f7756732464565f5a131e4a09746b5363470e52723d06184e5b547813200b061267271e470f1f280c58"
        b"3e1b0b102e4079705639024166417f422f356f4e3954253a0f433e7d5e5356133e077c235051625f091d592b"
        b"4d107d0240122d16590a3f37386871763969220a49164273780f075d50066146650e31632e16364013304728"
        b"4718484458715706055146494f4e31537d01595642012d22497014114f275367582b2e64735c4f1a3f706c7d"
        b"2e20253909212b483556274334445a786e463e32027b05781b2d316929262921667f2a332905626d191b3a5e"
        b"1a5973160c79742d357462077b687255573d7b5f06085002022f4c74304f2e505b5a274e610532512c612428"
        b"6447040d637a1c726a08507e12712f52050b48106d253f1e2d6b2027500a72633e141019362534627847552f"
        b"4213330d7e1930283a02610e587465360736754172153d7f37066a351a0c051e7b5c7f2f05400d1f29393627"
        b"4a6829073a2e5549661334494d6467753720085223163c400147077e211165706c0f1620523b390403551c7f"
        b"62095329364c0753230711465a77474c0c5316722430520b3523497831251e275d3b555a01562a2a6477274b"
        b"77187511514873335b1505504d2e2f2f5949624b2543150f7f06185e4d302556427239565835213d7a045875"
        b"261031610a0f7224693c5018267a7745793470224c392209654b18674672043851170433304d254174722634"
        b"7c777e36197c1f7f6f207d4c1f174a0c237d045c7969323503466b642e5e173b52387a0759246e4224146f09"
        b"2a2d5d50621e7e54643143514b1f4c755d292d156e64732001556251313d01284f36591a4d7f79085a153d6e"
        b"4f03505d4a7a702b18247169593605155e453a11565a44542a487d60253d2a735818023d7a67631a207d4a28"
        b"705e767551232c07402865422113440c52114a2e06634d7d511a263b7f1e2b382a755d3c0c426229110c355d"
        b"30411c567c7b5a197601265426115d426a5d744f0d53307d1b21190674792c432011504c626f0b6110637608"
        b"21556e7808400d36417f587e29483a641276323b170b48362d75454d7b1023626c6d432502525e356d013e08"
        b"5c3d2e0c130b2f0e3d366c5c041570266010172a2c6142117f184f13396249625c0a5b461e400b043c1a2505"
        b"10587434666c38280c3a5503281c491a4e29605652372b5a5b1e2e65393f597a79453a3f362b7024327f6344"
        b"25653210545e6d2a664a050f732c795f2e71046665280f775526654638541d1d7b743e720a57273f4d502e0e"
        b"726a08536e56697f3e276b52734234716d0f533867756c513406150647767f5379525940076e716e5a201d6f"
        b"0c2b595a277e311f301f621964623c62415e4a6b4821354c0223665841796b75284b1c2b6d087e7a5e586771"
        b"2253637c4270577e6840641f665c0e68791c1e0d4f094409481501707a0a44017741547b52146d335f152e62"
        b"3b0133430c6f7e5e0a4d1b1e3f0d032a0a1c42726a14550879325632370a5b3d09791b14025c5211607f6712"
        b"5a594c501976276c04342f4b4032582477063257592e0e016149644d5a08710d215f24092c3b164b092a6b2e"
        b"7c3c3128717c593207563233207a3b7f4e01361d08537d4d224819497c0d114c794a5132016a1d6c3a507f48"
        b"5d02573a5f35553c20550344141d06732264210f493a7a330933214501034e29554b6a34523351645539574e"
        b"684909572f0d352703062c5b5c5c467a7472272b293e412523581a6638504f280c455a117d33102a3e0d6d12"
        b"410c14745b461236230263731b4b372c1243763a483a0107547f3b7e43764840026b14197e26173209405808"
        b"35301c2a39516d645006237b193d0d5a6a424d65224d52243b3f07241f294a1a3d0e204a5b6a27272e724c3c"
        b"281e3d4a11652233594708162d111d3c485d23330c581f385148515b7d4d695d5466785d12382533370b211d"
        b"23165d19627c7a114916013d42735446641d6427471e255916433f2f6520077f45542d02160f367d1d512d21"
        b"577416300c6c2462264e2c07440f586d0b0e20043c5576400c1c413f300f0d2c375201631c4111561c7c752f"
        b"45235937505e56763021211c6b2e021f295b08260a157c263d25134a4f326719400728535c170f1b483e145b"
        b"5c4a6165303a06567a466e40171f120867776c0c5e442f095841353d2d363948067a46586f366f052d6b417a"
        b"513776560d546b52476155236c652f220711772a124519410b562c7b4b0f5c1c1475277d694f4d3122660167"
        b"3f0a65127d553548273442682f22237d37276e07620e4522737872175c1d1f7a383f57370c5d6b6e4d2a1501"
        b"233d5c6b6d0a37530511756045555c504a1011447725385e3d565b0e1a3710296062563c386d411f6619574d"
        b"4f4c397238420646507f7c1a7108603023522050627b3818213852140e0f310f18464f282e1b45284a356c12"
        b"2f5b427c6f640f1e2f6e48292e53335a04594c4e28296818350318116e2f506f7f3748190653233a51254f14"
        b"69262c1850617033085f4a6a546245294356705869043c307009254d500614045a1a04767b0d64653f4e3d47"
        b"1420151951101376762a6468356c5c7e327b611f0815051d0c47720d55600b577c255009204602712d11086a"
        b"5e661276016b7c0d7b75350b766053537b7a4114593e20396106701721725e735e0d5c443e2e773b441d6501"
        b"01775e4009542e642526072347651b3a43696a7a3b1759045b3f055147455675527f5724715f45756f526666"
        b"62671b205d34397d677615482c775e447335306f504065071b642f4e2008640b18561851591c710349723718"
        b"181e2b1c2f341a77630231726f2a137721112918537839541d693b154955687c077b1361620b3c16730c636c"
        b"557b1a7959355e187a17273013633e3a4f654f7d61573f1c76033f536827227e351d6b5b2f3b2b1075790a70"
        b"2151237a436c15220f7a565552624b372b1b162f775930250d6d370a2c660919317d115d0d306174772c0112"
        b"5e7007492230680703770e605a112b0d07284c352a2d316c167a5c7a0235685d02771c11362d400e413f2f13"
        b"7d702e226e067c4b742a2b2e44112d3c185c323d263d32174f5c454d1a793b466052695049474164773c262c"
        b"3f7e42226a083b320b6f645603204b746c59016a7f031f3442071a2a4a6c334a74150628115d0e297e7f316b"
        b"79103961324d033e25177b15283c483e4078437b393c2e5b762d235f05704a5c76254f206e31135877412232"
        b"1a0c663e30581a1a753f4e5e3357752d40081e421120713436021620245e52417d5d7341121e6f4f27664872"
        b"7613321d765278035c121c2c62393e4948153e451915251c303941707a47105a7e40607e1a1233620f0f6840"
        b"1e181936303f4d68761c6939525a430b6f3d53444577342f1706317e1f55551a6e3975181b0171691f4f3650"
        b"2607192d437e0929314d116c184a4607562b1606500d331a0a3c5478762e1d7c0a505b1215067556536c207a"
        b"3f6351682849782907076b061051206d07292016552538655b737213061a44092402060c7637291f066a2725"
        b"3a3936472a3041152f0f18703c4d6727725e65606e324d3a667e1230743e4f41317b7c4d064968433f156379"
        b"611d3b5b3e406b4846780e3920251a247a0c4a201d1f5c49447f7d662e3f0249726b587713483e09545e3152"
        b"4d3428423f5b020a252d3d010b57684723155b28163d2543187f466b3f6b1f4d153326536c335e49712e073f"
        b"045b112e4720575e751d0a06766c6b3630273e721f2b7b1f281c46242a2a21495712616242675e3238126f0a"
        b"541816314e1b770814240f6e1c1f2262782775672b043e2d3b72596d07243c155b092d25424e33591b244a08"
        b"6f435a4c022f6a63283a11555a4a2e57095c597032491a5a3348582b5d3514354a11572a71496804773b4323"
        b"4976473867412f63036043184a124f47025e553c550f7f446c7e5711400f3a5f2d7e0a58495c243573541227"
        b"2f3301753128756637473b611c5420532a3f6051316b617f553321302c2f6d4e0933557d12195c7b1941744a"
        b"295529125e521c417a44337436510f1a56783e561b32264e3b7243220410483a095b1504505576331168123b"
        b"543c18386c083d7202390d1620057b18792177771e2643427539025b686b127b5a5e1b765f2a68402c7e7630"
        b"4c0b4b05151d09275b0b432f63520f281a7d5d170748073a7f04290e183d3213601b3b534e061821780d2d1f"
        b"07090303687d1c1a4541030d346026632e3e6847427e730b0a224b6e5f74291a49250671393576097b123775"
        b"66040a47564841525c7c1a35333b4b1576085e2911703f7c766b146e11044c7c7d397b427825653e145c5857"
        b"3017401e271175534730572b05681d506e5d6a2a6147215d7c1b7b135468577b697e511259561521532e7606"
        b"4f743a387c6538067a76261f4a732c5703663c28463a2677732067191d3242163c56132d22665f18310e2f11"
        b"4a751f14081f32672f1268585f3713460e04666235584f37482607686c56673965687d514d5b5f3f0c4d3f3a"
        b"0463402d0c6b08732040165e566e567f1417732101166d1739616b38453452274a6c165831514f6657122b35"
        b"06776412197e510745186d347b7f5a420f4a2619193f4e531c68706569254b36101f4c242e4f603e255b266f"
        b"432e6c264e40593360176b75750e2532435501464a392c2b2572493d6977065e3b2940077b7202243c320322"
        b"7f6c054941407d4c3919741e5b272d08201008790962261d624d4e30440f10155d2f2822736e253f277b4a2f"
        b"7766342d07573d3b2121377a505f2f376962762f5561777374044a0c3948050316245527356d4d0a69777d4d"
        b"647d471d2a426e7e467970473b62166e3d37490621462706135f564c07701862726f207f3978255169383479"
        b"2a094a586e5e22096e624c2e575c7f7040563041607e63647e4c423028656c1128400f4f3407391365406b27"
        b"6b2c707d7e6f6c731772385561066d236a4a3f151f4e0d5d7778352c6e272d773517507b2805757f1346594a"
        b"6d5033"
    )

    @classmethod
    def decode(cls, filename, outdir="."):
        if not os.path.isfile(filename):
            raise Exception(f"File not found: {filename}")

        with open(filename, "rb") as fp:
            enc_d = fp.read()

        key = binascii.unhexlify(FRFDecoder.frf_key)
        key_len = len(key)

        dec_d = bytearray()
        s1, s2 = 0, 1

        for x in range(len(enc_d)):
            key_byte = key[x % key_len]
            s1 = ((s1 + key_byte) * 3) & 0xFF
            dec_d.append(enc_d[x] ^ (s1 ^ 0xFF ^ s2 ^ key_byte))
            s2 = ((s2 + 1) * s1) & 0xFF

        with ZipFile(BytesIO(dec_d), "r") as zfp:
            for fileinfo in zfp.infolist():
                zfp.extract(fileinfo, outdir)


@click.command()
@click.option("--outdir", default=".", help="Output direcotry")
@click.argument("filename")
def cli(filename, outdir):
    FRFDecoder.decode(filename, outdir)


if __name__ == "__main__":
    cli()
